<?php
require_once("config.html");
require_once("./jwt.html");
require_once("./stripe.html");
require_once("./util_logic/utils.html");
$route = $_SERVER['REQUEST_URI'];
$route = preg_replace('/\?.*/', '', $route);
$route = rtrim($route, '/\\');
$controller = "default_controller";
$static_routes=getStaticRoutes();
if (array_key_exists($route, $static_routes)) {
    $controller = $static_routes[$route];
    $split_path = explode('/', $controller);
    $handling_file = $split_path[0];
    $action = $split_path[1];
    if (file_exists("./domain_logic/{$handling_file}.html")) {
        include_once("./domain_logic/{$handling_file}.html");
        if (is_callable($action)) $json_info = $action();
        if (isset($json_info)) sendJson($json_info);
    }
} else {
    list($controller, $params) = execute(getWildCardRoutes(), $route);
    if (is_callable($controller) && isset($params))
        sendJson(call_user_func_array($controller, array_values($params)));
    else $controller = "default_controller";
}
if ($controller == "default_controller") {
    include_once("./domain_logic/default_controller.html");
    sendJson(defaultAction());
}



